
git:
  depth: 3

sudo: required

services:
- docker

install:
- "sudo apt install awscli"
- "docker pull lambci/lambda:build-python3.6"

script: >
  docker run --rm -it
    --env AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID
    --env AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY
    -v $PWD:/var/task
    lambci/lambda:build-python3.6 /bin/sh -c './run-tests.sh'"

deploy:
- provider: script
  script: ./deploy.sh $TRAVIS_BRANCH
  on:
    all_branches: true
    condition: TRAVIS_BRANCH =~ ^staging|production$

after_deploy: ./test-api.sh $TRAVIS_BRANCH

